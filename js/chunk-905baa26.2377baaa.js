(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-905baa26"],{"53c4":function(t,a,e){"use strict";var s=e("c760"),o=e.n(s);o.a},"69d7":function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",[s("loading",{attrs:{active:t.isLoading},on:{"update:active":function(a){t.isLoading=a}}},[s("img",{attrs:{alt:"Meason",src:e("333e"),width:"100"}})]),t._m(0),s("div",{staticClass:"form"},[s("form",{attrs:{action:""},on:{submit:function(t){t.preventDefault()}}},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-12"},[s("div",{staticClass:"form-group"},[t._m(1),s("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.name,expression:"formData.name"},{name:"validate",rawName:"v-validate",value:"required|max:50",expression:"'required|max:50'"}],staticClass:"form-control",class:{"is-invalid":t.errors.has("title")},attrs:{type:"text",placeholder:"請輸入音樂名稱",id:"title",name:"title","data-vv-as":"音樂名稱"},domProps:{value:t.formData.name},on:{input:function(a){a.target.composing||t.$set(t.formData,"name",a.target.value)}}}),t.errors.has("title")?s("p",{staticClass:"text-danger mt-1 small"},[t._v("\n              "+t._s(t.errors.first("title"))+"\n            ")]):t._e()])]),s("div",{staticClass:"col-md-6"},[s("div",{staticClass:"form-group"},[t._m(2),s("button",{staticClass:"form-control typeText",class:{"is-invalid":"type"===t.tempDom.errorInput},attrs:{type:"button",id:"type","data-toggle":"modal","data-target":"#type-modal"}},[t.formData.type[0]?t._e():s("span",[t._v("選擇作品類型")]),s("p",{staticClass:"texts"},t._l(t.formData.type,function(a,e){return s("span",{key:e},[t._v(t._s(a))])}),0)]),"type"===t.tempDom.errorInput?s("p",{staticClass:"text-danger mt-1 small"},[t._v("未選擇樂手")]):t._e()])]),s("div",{staticClass:"col-md-6"},[s("div",{staticClass:"form-group"},[t._m(3),s("button",{staticClass:"form-control",class:{"is-invalid":"photo"===t.tempDom.errorInput},attrs:{id:"photos","data-toggle":"modal","data-target":"#upload-img"},on:{click:function(a){t.tempDom.errorInput=null}}},[t.formData.cover?s("article",[s("div",{style:{backgroundImage:"url("+t.formData.cover+")"}}),t._v(" 作品封面\n              ")]):s("span",[t._v("選擇圖片")])]),"photo"===t.tempDom.errorInput?s("p",{staticClass:"text-danger mt-1 small"},[t._v("未選擇圖片")]):t._e()])]),s("div",{staticClass:"col-md-12"},[s("div",{staticClass:"form-group"},[t._m(4),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.formData.bio,expression:"formData.bio"},{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"form-control",class:{"is-invalid":t.errors.has("bio")},attrs:{rows:"10",placeholder:"可在此填寫創作理念、歌詞等作品相關介紹",name:"bio",id:"bio","data-vv-as":"介紹"},domProps:{value:t.formData.bio},on:{input:function(a){a.target.composing||t.$set(t.formData,"bio",a.target.value)}}})]),t.errors.has("bio")?s("p",{staticClass:"text-danger mt-1 small"},[t._v("\n            "+t._s(t.errors.first("bio"))+"\n          ")]):t._e()]),t._m(5),s("div",{staticClass:"col-lg-12 mt-5 mb-5"},[s("button",{staticClass:"btn btn-primary form-control",attrs:{disabled:!t.tempDom.uploadDone},on:{click:function(a){return t.editPost()}}},[t._v("更新貼文")])])])])]),s("div",{staticClass:"modal fade",attrs:{id:"type-modal",tabindex:"-1",role:"dialog","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog modal-dialog-centered",attrs:{role:"document"}},[s("div",{staticClass:"modal-content"},[t._m(6),s("div",{staticClass:"modal-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-12"},[s("div",{staticClass:"input-group mb-3"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.tempDom.filterInput,expression:"tempDom.filterInput"}],staticClass:"form-control",attrs:{type:"text",placeholder:"♫ Search","aria-label":"","aria-describedby":"basic-addon1"},domProps:{value:t.tempDom.filterInput},on:{input:function(a){a.target.composing||t.$set(t.tempDom,"filterInput",a.target.value)}}})])])]),s("div",{staticClass:"row",attrs:{id:"instrumentItem"}},t._l(t.tempDom.filterItem,function(a,e){return s("div",{directives:[{name:"show",rawName:"v-show",value:a,expression:"item"}],key:e,staticClass:"col-md-4 col-sm-4 col-6"},[s("div",{staticClass:"radio"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.tempDom.selectType[e],expression:"tempDom.selectType[index]"}],attrs:{type:"checkbox",name:"radio",disabled:t.formData.type.length>=3&&!t.tempDom.selectType[e],id:"radio"+e},domProps:{value:a,checked:Array.isArray(t.tempDom.selectType[e])?t._i(t.tempDom.selectType[e],a)>-1:t.tempDom.selectType[e]},on:{change:function(s){var o=t.tempDom.selectType[e],i=s.target,r=!!i.checked;if(Array.isArray(o)){var n=a,l=t._i(o,n);i.checked?l<0&&t.$set(t.tempDom.selectType,e,o.concat([n])):l>-1&&t.$set(t.tempDom.selectType,e,o.slice(0,l).concat(o.slice(l+1)))}else t.$set(t.tempDom.selectType,e,r)}}}),s("label",{attrs:{for:"radio"+e}},[t._v("\n                  "+t._s(a)+"\n                ")])])])}),0),t.formData.type.length>=3?s("p",{staticClass:"text-primary mt-1 small"},[t._v("\n            最多只能選三項\n          ")]):t._e()]),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"},on:{click:function(a){t.tempDom.errorInput=null}}},[t._v("選擇完成")])])])])]),s("div",{staticClass:"modal fade",attrs:{id:"upload-img",tabindex:"-1",role:"dialog","aria-hidden":"true","data-backdrop":"false","data-keyboard":"false"}},[s("div",{staticClass:"modal-dialog modal-dialog-centered modal-lg",attrs:{role:"document"}},[s("div",{staticClass:"modal-content"},[t._m(7),s("div",{staticClass:"modal-body"},[s("label",{staticClass:"files",attrs:{for:"file-input"}},[!t.tempDom.imgurl||t.errors.has("photo")?s("img",{staticClass:"select-img",attrs:{src:e("0259"),alt:"音樂封面選擇"}}):s("div",{staticClass:"img-preview"},[s("img",{attrs:{src:t.tempDom.imgurl,id:"scream"}})]),s("input",{directives:[{name:"validate",rawName:"v-validate",value:"size:5000|ext:jpg,png",expression:"'size:5000|ext:jpg,png'"}],attrs:{type:"file",name:"photo",id:"file-input",multiple:"true",accept:"image/*","data-vv-as":"圖片檔案"},on:{change:t.preview}}),t.errors.has("photo")?s("p",{staticClass:"text-danger mt-1 small"},[t._v("\n              請選擇小於 5MB 的圖片\n            ")]):t._e()])]),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-secondary",attrs:{type:"button","data-dismiss":"modal"}},[t._v("取消")]),s("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:t.errors.has("photo")},on:{click:function(a){return t.uploadImg()}}},[t._v("\n            上傳圖片\n          ")])])])])])],1)},o=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"user-title"},[e("button",{staticClass:"btn btn-outline-secondary btn-sm",attrs:{type:"button",onclick:"window.history.back();"}},[e("i",{staticClass:"fas fa-arrow-left"})]),e("h2",[e("i",{staticClass:"fas fa-plus-circle"}),t._v(" 發布音樂作品")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",{attrs:{for:"title"}},[e("i",{staticClass:"fas fa-music"}),t._v("音樂名稱"),e("b",[t._v("*")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",{attrs:{for:"type"}},[e("i",{staticClass:"fas fa-music"}),t._v("選擇類型"),e("b",[t._v("*")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",{attrs:{for:"photos"}},[e("i",{staticClass:"fas fa-music"}),t._v("作品封面"),e("b",[t._v("*")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",{attrs:{for:"bio"}},[e("i",{staticClass:"fas fa-music"}),t._v("作品介紹 / 歌詞"),e("b",[t._v("*")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"col-md-12"},[e("label",{attrs:{for:"song"}},[e("i",{staticClass:"fas fa-music"}),t._v("音樂作品檔案"),e("b",[t._v("*")])]),e("p",{staticClass:"text-success ml-3"},[t._v("\n            為公平起見，音樂作品檔案不提供更換。\n            "),e("span",{staticClass:"text-dark"},[t._v("如需更換，請重新發佈音樂作品")])])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title"},[t._v("\n            選擇類型\n          ")]),e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[e("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title"},[t._v("\n            選擇音樂封面\n          ")]),e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[e("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])])}],i=(e("7f7f"),e("34ef"),e("4917"),e("28a5"),e("6b54"),e("c5f6"),e("ac6a"),e("8aa5")),r=e.n(i),n=e("1157"),l=e.n(n),c={props:["userData"],data:function(){return{isLoading:!1,formData:{name:"",type:[],bio:"",cover:""},tempDom:{errorInput:"",filterInput:"",filterItem:["COVER","電音","搖滾","民謠"],selectType:[],imgurl:"",uploadText:"",uploadDone:!0,alldataDone:!1},tempData:{options:["COVER","電音","搖滾","民謠"]}}},watch:{"tempDom.filterInput":{handler:function(t){var a=this;a.tempDom.filterItem=a.tempData.options.map(function(a,e,s){return-1!==a.indexOf(t)&&a})}},"tempDom.selectType":{handler:function(t){var a=this;a.formData.type=[],t.forEach(function(t,e){t&&a.formData.type.push(a.tempData.options[e])})}},"formData.bio":{handler:function(t){var a=document.getElementById("bio"),e=a.clientHeight;e=Math.max(a.scrollHeight,e),e>a.clientHeight&&(a.style.height=e+"px")}}},methods:{getData:function(){var t=this,a="".concat("https://glacial-bayou-94392.herokuapp.com","/getData");t.$http.post(a,{url:"users/".concat(t.userData.uid,"/music/").concat(t.$route.params.id)}).then(function(a){a.data.poster_uid===t.userData.uid&&(t.formData=a.data)}).catch(function(){alert("取得資料失敗，請聯絡客服人員")})},preview:function(t){var a=this,e=t.target.files[0];a.tempDom.imgurl=URL.createObjectURL(e)},cvs:function(){var t,a=this,e=600,s=document.createElement("canvas"),o=new Image,i=s.getContext("2d"),r=l()("#scream"),n=r.height(),c=r.width(),m=e*n/c;return o.src=a.tempDom.imgurl,s.width=e,s.height=m,i.clearRect(0,0,e,m),i.drawImage(o,0,0,e,m),t=s.toDataURL("image/jpeg",1),t},uploadImg:function(){var t=this;t.isLoading=!0;var a=Number(new Date),e=a.toString()+t.userData.uid,s=r.a.storage().ref("music_photo/"+e),o=t.dataURLtoFile(t.cvs(),"fileName");s.put(o).then(function(a){a.ref.getDownloadURL().then(function(a){t.formData.cover=a,l()("#upload-img").modal("hide"),t.isLoading=!1})}).catch(function(t){alert("上傳失敗，請重新整理後重試"),console.log(t)})},dataURLtoFile:function(t,a){var e=t.split(","),s=e[0].match(/:(.*?);/)[1],o=atob(e[1]),i=o.length,r=new Uint8Array(i);while(i--)r[i]=o.charCodeAt(i);return new File([r],a,{type:s})},editPost:function(){var t=this;this.$validator.validate().then(function(a){a?t.formData.type[0]?t.formData.cover?(t.tempDom.alldataDone=!0,t.userData?t.sendPostAPI():(alert("會員登入狀況出現錯誤，請重新登入"),t.$router.push("/"))):t.tempDom.errorInput="photo":t.tempDom.errorInput="type":console.log("欄位不完整")})},sendPostAPI:function(){var t=this;t.isLoading=!0;var a="".concat("https://glacial-bayou-94392.herokuapp.com","/editMusicData"),e={artist:t.userData.displayName,bio:t.formData.bio,type:t.formData.type,cover:t.formData.cover,poster_uid:t.formData.poster_uid,name:t.formData.name,id:t.formData.id};this.$http.post(a,{reqData:e}).then(function(a){a.data.success&&(t.isLoading=!1,t.$router.push("/user/profile"))}).catch(function(a){console.error("寫入錯誤",a),alert("更新失敗，請稍後再重試，或聯繫迷聲客服中心"),t.isLoading=!1})}},created:function(){var t=this;t.getData(),window.onbeforeunload=function(t){t.returnValue="離開後不會保存內容"}},beforeRouteLeave:function(t,a,e){if(this.tempDom.alldataDone)e();else{var s=window.confirm("確定要離開嗎？系統不會保存目前內容");s?e():e(!1)}}},m=c,d=(e("53c4"),e("2877")),u=Object(d["a"])(m,s,o,!1,null,"578bf31e",null);a["default"]=u.exports},"7f7f":function(t,a,e){var s=e("86cc").f,o=Function.prototype,i=/^\s*function ([^ (]*)/,r="name";r in o||e("9e1e")&&s(o,r,{configurable:!0,get:function(){try{return(""+this).match(i)[1]}catch(t){return""}}})},c760:function(t,a,e){}}]);
//# sourceMappingURL=chunk-905baa26.2377baaa.js.map