(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1ebfff84"],{"511c":function(t,a,e){},"7f7f":function(t,a,e){var s=e("86cc").f,o=Function.prototype,r=/^\s*function ([^ (]*)/,i="name";i in o||e("9e1e")&&s(o,i,{configurable:!0,get:function(){try{return(""+this).match(r)[1]}catch(t){return""}}})},ab58:function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",[s("loading",{attrs:{active:t.isLoading},on:{"update:active":function(a){t.isLoading=a}}},[s("img",{attrs:{alt:"Meason",src:e("333e"),width:"100"}})]),t._m(0),s("div",{staticClass:"form"},[s("form",{attrs:{action:""},on:{submit:function(t){t.preventDefault()}}},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-12"},[s("div",{staticClass:"form-group"},[t._m(1),s("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.name,expression:"formData.name"},{name:"validate",rawName:"v-validate",value:"required|max:50",expression:"'required|max:50'"}],staticClass:"form-control",class:{"is-invalid":t.errors.has("title")},attrs:{type:"text",placeholder:"請輸入音樂名稱",id:"title",name:"title","data-vv-as":"音樂名稱"},domProps:{value:t.formData.name},on:{input:function(a){a.target.composing||t.$set(t.formData,"name",a.target.value)}}}),t.errors.has("title")?s("p",{staticClass:"text-danger mt-1 small"},[t._v("\n              "+t._s(t.errors.first("title"))+"\n            ")]):t._e()])]),s("div",{staticClass:"col-md-6"},[s("div",{staticClass:"form-group"},[t._m(2),s("button",{staticClass:"form-control typeText",class:{"is-invalid":"type"===t.tempDom.errorInput},attrs:{type:"button",id:"type","data-toggle":"modal","data-target":"#type-modal"}},[t.formData.type[0]?t._e():s("span",[t._v("選擇作品類型")]),s("p",{staticClass:"texts"},t._l(t.formData.type,function(a,e){return s("span",{key:e},[t._v(t._s(a))])}),0)]),"type"===t.tempDom.errorInput?s("p",{staticClass:"text-danger mt-1 small"},[t._v("未選擇樂手")]):t._e()])]),s("div",{staticClass:"col-md-6"},[s("div",{staticClass:"form-group"},[t._m(3),s("button",{staticClass:"form-control",class:{"is-invalid":"photo"===t.tempDom.errorInput},attrs:{id:"photos","data-toggle":"modal","data-target":"#upload-img"},on:{click:function(a){t.tempDom.errorInput=null}}},[t.formData.cover?s("article",[s("div",{style:{backgroundImage:"url("+t.formData.cover+")"}}),t._v(" 作品封面\n              ")]):s("span",[t._v("選擇圖片")])]),"photo"===t.tempDom.errorInput?s("p",{staticClass:"text-danger mt-1 small"},[t._v("未選擇圖片")]):t._e()])]),s("div",{staticClass:"col-md-12"},[s("div",{staticClass:"form-group"},[t._m(4),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.formData.bio,expression:"formData.bio"},{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"form-control",class:{"is-invalid":t.errors.has("bio")},attrs:{rows:"10",placeholder:"可在此填寫創作理念、歌詞等作品相關介紹",name:"bio",id:"bio","data-vv-as":"介紹"},domProps:{value:t.formData.bio},on:{input:function(a){a.target.composing||t.$set(t.formData,"bio",a.target.value)}}})]),t.errors.has("bio")?s("p",{staticClass:"text-danger mt-1 small"},[t._v("\n            "+t._s(t.errors.first("bio"))+"\n          ")]):t._e()]),s("div",{staticClass:"col-md-12"},[t._m(5),t.tempDom.uploadDone?s("span",{staticClass:"text-success ml-3"},[t._v("\n            音樂檔案上傳完成\n            "),s("a",{attrs:{href:"#"},on:{click:function(a){a.preventDefault(),t.tempDom.uploadDone=!1,t.formData.url=""}}},[t._v("(修改)")])]):s("div",{staticClass:"input-group"},[s("input",{directives:[{name:"validate",rawName:"v-validate",value:"required|size:10000|ext:mp3",expression:"'required|size:10000|ext:mp3'"}],staticClass:"form-control",attrs:{type:"file",name:"song",id:"song",multiple:"true",accept:"audio/mp3","data-vv-as":"音樂檔案",disabled:""!==t.tempDom.uploadText},on:{change:function(a){t.tempDom.errorInput=null}}}),s("div",{staticClass:"input-group-append"},[s("button",{staticClass:"btn btn-info ",attrs:{type:"button",disabled:""!==t.tempDom.uploadText||t.errors.has("song")},on:{click:function(a){return t.uploadSong()},focus:function(a){t.tempDom.errorInput=null}}},[t.tempDom.uploadText&&"上傳完成"!==t.tempDom.uploadText?s("span",[s("i",{staticClass:"fas fa-spinner fa-spin"})]):t._e(),t._v("                  \n                上傳音樂\n              ")])])]),t.tempDom.uploadText&&!t.tempDom.uploadDone?s("div",{staticClass:"progress"},[s("div",{staticClass:"progress-bar progress-bar-striped progress-bar-animated",attrs:{role:"progressbar","aria-valuemin":"0","aria-valuemax":"100",id:"progressing"}})]):t._e(),t.errors.has("song")||"song"===t.tempDom.errorInput?s("p",{staticClass:"text-danger mt-1 small"},[t._v("\n            請選擇小於 10MB 的 .mp3 音樂檔案\n          ")]):t._e(),t.tempDom.uploadText&&!t.tempDom.uploadDone?s("p",{staticClass:"text-success mt-1 small"},[t._v("\n            "+t._s(t.tempDom.uploadText)+"\n          ")]):t._e()]),s("div",{staticClass:"col-lg-12 mt-5 mb-5"},[s("button",{staticClass:"btn btn-primary form-control",attrs:{disabled:!t.tempDom.uploadDone},on:{click:function(a){return t.creatPost()}}},[t._v("立即發佈")])])])])]),s("div",{staticClass:"modal fade",attrs:{id:"type-modal",tabindex:"-1",role:"dialog","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog modal-dialog-centered",attrs:{role:"document"}},[s("div",{staticClass:"modal-content"},[t._m(6),s("div",{staticClass:"modal-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-12"},[s("div",{staticClass:"input-group mb-3"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.tempDom.filterInput,expression:"tempDom.filterInput"}],staticClass:"form-control",attrs:{type:"text",placeholder:"♫ Search","aria-label":"","aria-describedby":"basic-addon1"},domProps:{value:t.tempDom.filterInput},on:{input:function(a){a.target.composing||t.$set(t.tempDom,"filterInput",a.target.value)}}})])])]),s("div",{staticClass:"row",attrs:{id:"instrumentItem"}},t._l(t.tempDom.filterItem,function(a,e){return s("div",{directives:[{name:"show",rawName:"v-show",value:a,expression:"item"}],key:e,staticClass:"col-md-4 col-sm-4 col-6"},[s("div",{staticClass:"radio"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.tempDom.selectType[e],expression:"tempDom.selectType[index]"}],attrs:{type:"checkbox",name:"radio",disabled:t.formData.type.length>=3&&!t.tempDom.selectType[e],id:"radio"+e},domProps:{value:a,checked:Array.isArray(t.tempDom.selectType[e])?t._i(t.tempDom.selectType[e],a)>-1:t.tempDom.selectType[e]},on:{change:function(s){var o=t.tempDom.selectType[e],r=s.target,i=!!r.checked;if(Array.isArray(o)){var n=a,l=t._i(o,n);r.checked?l<0&&t.$set(t.tempDom.selectType,e,o.concat([n])):l>-1&&t.$set(t.tempDom.selectType,e,o.slice(0,l).concat(o.slice(l+1)))}else t.$set(t.tempDom.selectType,e,i)}}}),s("label",{attrs:{for:"radio"+e}},[t._v("\n                  "+t._s(a)+"\n                ")])])])}),0),t.formData.type.length>=3?s("p",{staticClass:"text-primary mt-1 small"},[t._v("\n            最多只能選三項\n          ")]):t._e()]),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"},on:{click:function(a){t.tempDom.errorInput=null}}},[t._v("選擇完成")])])])])]),s("div",{staticClass:"modal fade",attrs:{id:"upload-img",tabindex:"-1",role:"dialog","aria-hidden":"true","data-backdrop":"false","data-keyboard":"false"}},[s("div",{staticClass:"modal-dialog modal-dialog-centered modal-lg",attrs:{role:"document"}},[s("div",{staticClass:"modal-content"},[t._m(7),s("div",{staticClass:"modal-body"},[s("label",{staticClass:"files",attrs:{for:"file-input"}},[!t.tempDom.imgurl||t.errors.has("photo")?s("img",{staticClass:"select-img",attrs:{src:e("0259"),alt:"音樂封面選擇"}}):s("div",{staticClass:"img-preview"},[s("img",{attrs:{src:t.tempDom.imgurl,id:"scream"}})]),s("input",{directives:[{name:"validate",rawName:"v-validate",value:"size:5000|ext:jpg,png",expression:"'size:5000|ext:jpg,png'"}],attrs:{type:"file",name:"photo",id:"file-input",multiple:"true",accept:"image/*","data-vv-as":"圖片檔案"},on:{change:t.preview}}),t.errors.has("photo")?s("p",{staticClass:"text-danger mt-1 small"},[t._v("\n              請選擇小於 5MB 的圖片\n            ")]):t._e()])]),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-secondary",attrs:{type:"button","data-dismiss":"modal"}},[t._v("取消")]),s("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:t.errors.has("photo")},on:{click:function(a){return t.uploadImg()}}},[t._v("\n            上傳圖片\n          ")])])])])])],1)},o=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"user-title"},[e("button",{staticClass:"btn btn-outline-secondary btn-sm",attrs:{type:"button",onclick:"window.history.back();"}},[e("i",{staticClass:"fas fa-arrow-left"})]),e("h2",[e("i",{staticClass:"fas fa-plus-circle"}),t._v(" 發布音樂作品")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",{attrs:{for:"title"}},[e("i",{staticClass:"fas fa-music"}),t._v("音樂名稱"),e("b",[t._v("*")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",{attrs:{for:"type"}},[e("i",{staticClass:"fas fa-music"}),t._v("選擇類型"),e("b",[t._v("*")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",{attrs:{for:"photos"}},[e("i",{staticClass:"fas fa-music"}),t._v("作品封面"),e("b",[t._v("*")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",{attrs:{for:"bio"}},[e("i",{staticClass:"fas fa-music"}),t._v("作品介紹 / 歌詞"),e("b",[t._v("*")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",{attrs:{for:"song"}},[e("i",{staticClass:"fas fa-music"}),t._v("音樂作品檔案"),e("b",[t._v("*")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title"},[t._v("\n            選擇類型\n          ")]),e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[e("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title"},[t._v("\n            選擇音樂封面\n          ")]),e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[e("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])])}],r=(e("7f7f"),e("34ef"),e("4917"),e("28a5"),e("6b54"),e("c5f6"),e("ac6a"),e("8aa5")),i=e.n(r),n=e("1157"),l=e.n(n),m={props:["userData"],data:function(){return{isLoading:!1,formData:{name:"",type:[],bio:"",cover:""},tempDom:{errorInput:"",filterInput:"",filterItem:["COVER","電音","搖滾","民謠"],selectType:[],imgurl:"",uploadText:"",uploadDone:!1,alldataDone:!1},tempData:{options:["COVER","電音","搖滾","民謠"]}}},watch:{"tempDom.filterInput":{handler:function(t){var a=this;a.tempDom.filterItem=a.tempData.options.map(function(a,e,s){return-1!==a.indexOf(t)&&a})}},"tempDom.selectType":{handler:function(t){var a=this;a.formData.type=[],t.forEach(function(t,e){t&&a.formData.type.push(a.tempData.options[e])})}},"formData.bio":{handler:function(t){var a=document.getElementById("bio"),e=a.clientHeight;e=Math.max(a.scrollHeight,e),e>a.clientHeight&&(a.style.height=e+"px")}}},methods:{preview:function(t){var a=this,e=t.target.files[0];a.tempDom.imgurl=URL.createObjectURL(e)},cvs:function(){var t,a=this,e=600,s=document.createElement("canvas"),o=new Image,r=s.getContext("2d"),i=l()("#scream"),n=i.height(),m=i.width(),c=e*n/m;return o.src=a.tempDom.imgurl,s.width=e,s.height=c,r.clearRect(0,0,e,c),r.drawImage(o,0,0,e,c),t=s.toDataURL("image/jpeg",1),t},uploadImg:function(){var t=this;t.isLoading=!0;var a=Number(new Date),e=a.toString()+t.userData.uid,s=i.a.storage().ref("music_photo/"+e),o=t.dataURLtoFile(t.cvs(),"fileName");s.put(o).then(function(a){a.ref.getDownloadURL().then(function(a){t.formData.cover=a,l()("#upload-img").modal("hide"),t.isLoading=!1})}).catch(function(t){alert("上傳失敗，請重新整理後重試"),console.log(t)})},dataURLtoFile:function(t,a){var e=t.split(","),s=e[0].match(/:(.*?);/)[1],o=atob(e[1]),r=o.length,i=new Uint8Array(r);while(r--)i[r]=o.charCodeAt(r);return new File([i],a,{type:s})},creatPost:function(){var t=this;this.$validator.validate().then(function(a){a?t.formData.type[0]?t.formData.cover?t.formData.url?(t.tempDom.alldataDone=!0,t.userData?t.sendPostAPI():(alert("會員登入狀況出現錯誤，請重新登入"),t.$router.push("/"))):t.tempDom.errorInput="song":t.tempDom.errorInput="photo":t.tempDom.errorInput="type":console.log("欄位不完整")})},sendPostAPI:function(){var t=this;t.isLoading=!0;var a="".concat("https://glacial-bayou-94392.herokuapp.com","/creatMusic"),e={artist:t.userData.displayName,bio:t.formData.bio,timestamp:Date.now(),legal:!0,display:!0,type:t.formData.type,cover:t.formData.cover,poster_uid:t.userData.uid,name:t.formData.name,url:t.formData.url,view:0,fileName:t.formData.fileName,id:""};this.$http.post(a,{formData:e}).then(function(a){a.data.success&&(t.isLoading=!1,t.$router.push("/user/profile"))}).catch(function(a){console.error("寫入錯誤",a),alert("發佈失敗，請稍後再重試，或聯繫迷聲客服中心"),t.isLoading=!1})},uploadSong:function(){var t=this,a=Number(new Date),e=a.toString()+t.userData.uid,s=i.a.storage().ref("music/"+e),o=document.getElementById("song").files[0],r=s.put(o);t.formData.fileName=e,r.on("state_changed",function(a){var e=a.bytesTransferred/a.totalBytes*100;switch(l()("#progressing").width(e+"%"),a.state){case i.a.storage.TaskState.PAUSED:t.tempDom.uploadText="上傳終止";break;case i.a.storage.TaskState.RUNNING:t.tempDom.uploadText="正在上傳音檔，請勿離開視窗";break}},function(a){t.tempDom.uploadText="圖片上傳失敗，建議重新整理後重試"},function(){r.snapshot.ref.getDownloadURL().then(function(a){t.formData.url=a,t.tempDom.uploadText="",t.tempDom.uploadDone=!0})})}},created:function(){window.onbeforeunload=function(t){t.returnValue="離開後不會保存內容"}},beforeRouteLeave:function(t,a,e){if(this.tempDom.alldataDone)e();else{var s=window.confirm("確定要離開嗎？系統不會保存目前內容");s?e():e(!1)}}},c=m,d=(e("fdf4"),e("2877")),p=Object(d["a"])(c,s,o,!1,null,"6915afdb",null);a["default"]=p.exports},fdf4:function(t,a,e){"use strict";var s=e("511c"),o=e.n(s);o.a}}]);
//# sourceMappingURL=chunk-1ebfff84.7c0aab55.js.map